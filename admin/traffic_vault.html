
<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Traffic Vault Administration &mdash; Traffic Control 8.1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css" />

  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Quick How To Guides" href="quick_howto/index.html" />
    <link rel="prev" title="testing" href="t3c/testing.html" />
    <link href="../_static/theme_overrides.css" rel="stylesheet" type="text/css"/>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Traffic Control
              <img src="../_static/ATC-SVG-FULL-WHITE.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                8.1.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../basics/index.html">CDN Basics</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../overview/index.html">Traffic Control Overview</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Administrator’s Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="traffic_ops.html">Traffic Ops</a></li>
<li class="toctree-l2"><a class="reference internal" href="environment_creation.html">Environment Creation</a></li>
<li class="toctree-l2"><a class="reference internal" href="traffic_portal/index.html">Traffic Portal</a></li>
<li class="toctree-l2"><a class="reference internal" href="traffic_monitor.html">Traffic Monitor Administration</a></li>
<li class="toctree-l2"><a class="reference internal" href="traffic_router.html">Traffic Router Administration</a></li>
<li class="toctree-l2"><a class="reference internal" href="traffic_stats.html">Traffic Stats Administration</a></li>
<li class="toctree-l2"><a class="reference internal" href="traffic_server.html">Traffic Server Administration</a></li>
<li class="toctree-l2"><a class="reference internal" href="t3c/index.html">t3c</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Traffic Vault Administration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#postgresql">PostgreSQL</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#example-cdn-conf-snippet">Example cdn.conf snippet:</a></li>
<li class="toctree-l4"><a class="reference internal" href="#administration-of-the-postgresql-database-for-traffic-vault">Administration of the PostgreSQL database for Traffic Vault</a></li>
<li class="toctree-l4"><a class="reference internal" href="#app-db-reencrypt-reencrypt">app/db/reencrypt/reencrypt</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#riak-deprecated">Riak (deprecated)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id1">Example cdn.conf snippet:</a></li>
<li class="toctree-l4"><a class="reference internal" href="#installing-the-riak-backend-for-traffic-vault">Installing the Riak backend for Traffic Vault</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configuring-riak">Configuring Riak</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configuring-riak-search">Configuring Riak Search</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="quick_howto/index.html">Quick How To Guides</a></li>
<li class="toctree-l2"><a class="reference internal" href="cdni.html">CDNi Administration</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../development/index.html">Developer’s Guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">Traffic Ops API</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tools/index.html">Tools</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">FAQ</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Traffic Control</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Administrator’s Guide</a></li>
      <li class="breadcrumb-item active">Traffic Vault Administration</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/admin/traffic_vault.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="traffic-vault-administration">
<span id="traffic-vault-admin"></span><h1>Traffic Vault Administration<a class="headerlink" href="#traffic-vault-administration" title="Permalink to this heading"></a></h1>
<p>Currently, the supported backends for Traffic Vault are PostgreSQL and Riak, but Riak support is deprecated and may be removed in a future release. More backends may be supported in the future.</p>
<section id="postgresql">
<span id="traffic-vault-postgresql-backend"></span><h2>PostgreSQL<a class="headerlink" href="#postgresql" title="Permalink to this heading"></a></h2>
<p>In order to use the PostgreSQL backend for Traffic Vault, you will need to set the <code class="docutils literal notranslate"><span class="pre">traffic_vault_backend</span></code> option to <code class="docutils literal notranslate"><span class="pre">&quot;postgres&quot;</span></code> and include the necessary configuration in the <code class="docutils literal notranslate"><span class="pre">traffic_vault_config</span></code> section in <code class="file docutils literal notranslate"><span class="pre">cdn.conf</span></code>. The <code class="docutils literal notranslate"><span class="pre">traffic_vault_config</span></code> options for the PostgreSQL backend are as follows:</p>
<dl class="field-list simple">
<dt class="field-odd">dbname<span class="colon">:</span></dt>
<dd class="field-odd"><p>The name of the database to use</p>
</dd>
<dt class="field-even">hostname<span class="colon">:</span></dt>
<dd class="field-even"><p>The hostname of the database server to connect to</p>
</dd>
<dt class="field-odd">password<span class="colon">:</span></dt>
<dd class="field-odd"><p>The password to use when connecting to the database</p>
</dd>
<dt class="field-even">port<span class="colon">:</span></dt>
<dd class="field-even"><p>The port number that the database listens for new connections on (NOTE: the PostgreSQL default is 5432)</p>
</dd>
<dt class="field-odd">user<span class="colon">:</span></dt>
<dd class="field-odd"><p>The username to use when connecting to the database</p>
</dd>
<dt class="field-even">aes_key_location<span class="colon">:</span></dt>
<dd class="field-even"><p>The location on-disk for a base64-encoded AES key used to encrypt secrets before they are stored. It is highly recommended to backup this key to a safe, secure storage location, because if it is lost, you will lose access to all your Traffic Vault data. Either this option or <code class="docutils literal notranslate"><span class="pre">hashicorp_vault</span></code> must be used.</p>
</dd>
<dt class="field-odd">hashicorp_vault<span class="colon">:</span></dt>
<dd class="field-odd"><p>This group of configuration options is for fetching the base64-encoded AES key from <a class="reference external" href="https://www.vaultproject.io/">HashiCorp Vault</a>. This uses the <a class="reference external" href="https://learn.hashicorp.com/tutorials/vault/approle">AppRole authentication method</a>.</p>
<dl class="field-list simple">
<dt class="field-odd">address<span class="colon">:</span></dt>
<dd class="field-odd"><p>The address of the HashiCorp Vault server, e.g. <a class="reference external" href="http://localhost:8200">http://localhost:8200</a></p>
</dd>
<dt class="field-even">role_id<span class="colon">:</span></dt>
<dd class="field-even"><p>The RoleID of the AppRole.</p>
</dd>
<dt class="field-odd">secret_id<span class="colon">:</span></dt>
<dd class="field-odd"><p>The SecretID issued against the AppRole.</p>
</dd>
<dt class="field-even">secret_path<span class="colon">:</span></dt>
<dd class="field-even"><p>The URI path where the secret AES key is located, e.g. /v1/secret/data/trafficvault. The secret should be stored using the <a class="reference external" href="https://www.vaultproject.io/docs/secrets/kv">KV Secrets Engine</a> with a key of <code class="docutils literal notranslate"><span class="pre">traffic_vault_key</span></code> and value of a base64-encoded AES key, e.g. <code class="docutils literal notranslate"><span class="pre">traffic_vault_key='WoFc86CisM1aXo8D5GvDnq2h9kjULuIP4upaqX15SRc='</span></code>.</p>
</dd>
<dt class="field-odd">login_path<span class="colon">:</span></dt>
<dd class="field-odd"><p>Optional. The URI path used to login with the AppRole method. Default: /v1/auth/approle/login</p>
</dd>
<dt class="field-even">timeout_sec<span class="colon">:</span></dt>
<dd class="field-even"><p>Optional. The timeout (in seconds) for requests. Default: 30</p>
</dd>
<dt class="field-odd">insecure<span class="colon">:</span></dt>
<dd class="field-odd"><p>Optional. Disable server certificate verification. This should only be used for testing purposes. Default: false</p>
</dd>
</dl>
</dd>
<dt class="field-even">conn_max_lifetime_seconds<span class="colon">:</span></dt>
<dd class="field-even"><p>Optional. The maximum amount of time (in seconds) a connection may be reused. If negative, connections are not closed due to a connection’s age. If 0 or unset, the default of 60 is used.</p>
</dd>
<dt class="field-odd">max_connections<span class="colon">:</span></dt>
<dd class="field-odd"><p>Optional. The maximum number of open connections to the database. Default: 0 (unlimited)</p>
</dd>
<dt class="field-even">max_idle_connections<span class="colon">:</span></dt>
<dd class="field-even"><p>Optional. The maximum number of connections in the idle connection pool. If negative, no idle connections are retained. If 0 or unset, the default of 30 is used.</p>
</dd>
<dt class="field-odd">query_timeout_seconds<span class="colon">:</span></dt>
<dd class="field-odd"><p>Optional. The duration (in seconds) after which database queries will time out and be cancelled. Default: 30</p>
</dd>
<dt class="field-even">ssl<span class="colon">:</span></dt>
<dd class="field-even"><p>Optional. Whether or not to use SSL to connect to the database. Default: false</p>
</dd>
</dl>
<section id="example-cdn-conf-snippet">
<h3>Example cdn.conf snippet:<a class="headerlink" href="#example-cdn-conf-snippet" title="Permalink to this heading"></a></h3>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;traffic_ops_golang&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;traffic_vault_backend&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;postgres&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;traffic_vault_config&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;dbname&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;tv_development&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;hostname&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;localhost&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;user&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;traffic_vault&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;password&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;twelve&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;port&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">5432</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;ssl&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;conn_max_lifetime_seconds&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">60</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;max_connections&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">500</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;max_idle_connections&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;query_timeout_seconds&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;aes_key_location&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/opt/traffic_ops/app/conf/tv.key&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="administration-of-the-postgresql-database-for-traffic-vault">
<h3>Administration of the PostgreSQL database for Traffic Vault<a class="headerlink" href="#administration-of-the-postgresql-database-for-traffic-vault" title="Permalink to this heading"></a></h3>
<p>Similar to administering the Traffic Ops database, the <a class="reference internal" href="../development/traffic_ops.html#database-management"><span class="std std-ref">admin</span></a> tool should be used for administering the PostgreSQL Traffic Vault backend.</p>
</section>
<section id="app-db-reencrypt-reencrypt">
<h3>app/db/reencrypt/reencrypt<a class="headerlink" href="#app-db-reencrypt-reencrypt" title="Permalink to this heading"></a></h3>
<p>The <strong class="program">reencrypt</strong> binary is used to re-encrypt all data in the Postgres Traffic Vault with a new base64-encoded AES key.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For proper resolution of configuration files, it’s recommended that this binary be run from the <code class="docutils literal notranslate"><span class="pre">app/db/reencrypt</span></code> directory.</p>
</div>
<section id="usage">
<h4>Usage<a class="headerlink" href="#usage" title="Permalink to this heading"></a></h4>
<p><code class="docutils literal notranslate"><span class="pre">./reencrypt</span> <span class="pre">[options]</span></code></p>
</section>
<section id="options-and-arguments">
<h4>Options and Arguments<a class="headerlink" href="#options-and-arguments" title="Permalink to this heading"></a></h4>
<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-reencrypt-new-key">
<span class="sig-name descname"><span class="pre">--new-key</span></span><span class="sig-prename descclassname"> <span class="pre">NEW_KEY</span></span><a class="headerlink" href="#cmdoption-reencrypt-new-key" title="Permalink to this definition"></a></dt>
<dd><p>(Optional) The file path for the new base64-encoded AES key. Default is <code class="docutils literal notranslate"><span class="pre">/opt/traffic_ops/app/conf/new.key</span></code>.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-reencrypt-previous-key">
<span class="sig-name descname"><span class="pre">--previous-key</span></span><span class="sig-prename descclassname"> <span class="pre">PREVIOUS_KEY</span></span><a class="headerlink" href="#cmdoption-reencrypt-previous-key" title="Permalink to this definition"></a></dt>
<dd><p>(Optional) The file path for the previous base64-encoded AES key. Default is <code class="docutils literal notranslate"><span class="pre">/opt/traffic_ops/app/conf/aes.key</span></code>.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-reencrypt-cfg">
<span class="sig-name descname"><span class="pre">--cfg</span></span><span class="sig-prename descclassname"> <span class="pre">CONFIG_FILE</span></span><a class="headerlink" href="#cmdoption-reencrypt-cfg" title="Permalink to this definition"></a></dt>
<dd><p>(Optional) The path for the configuration file. Default is <code class="docutils literal notranslate"><span class="pre">./reencrypt.conf</span></code>.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-reencrypt-help">
<span class="sig-name descname"><span class="pre">--help</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-reencrypt-help" title="Permalink to this definition"></a></dt>
<dd><p>(Optional) Print usage information and exit.</p>
</dd></dl>

<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-number">#67 </span><span class="caption-text">Example Usage</span><a class="headerlink" href="#id2" title="Permalink to this code"></a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./reencrypt<span class="w"> </span>--new-key<span class="w"> </span>~/exampleNewKey.txt<span class="w"> </span>--previous-key<span class="w"> </span>~/exampleOldKey.txt
</pre></div>
</div>
</div>
</section>
<section id="reencrypt-conf">
<h4>reencrypt.conf<a class="headerlink" href="#reencrypt-conf" title="Permalink to this heading"></a></h4>
<p>This file deals with configuration of the Traffic Vault Database to be used with the <strong class="program">reencrypt</strong> tool.</p>
<dl class="field-list simple">
<dt class="field-odd">dbname<span class="colon">:</span></dt>
<dd class="field-odd"><p>The name of the PostgreSQL database used.</p>
</dd>
<dt class="field-even">hostname<span class="colon">:</span></dt>
<dd class="field-even"><p>The hostname (<abbr title="Fully Qualified Domain Name">FQDN</abbr>) of the server that runs the Traffic Vault Database.</p>
</dd>
<dt class="field-odd">password<span class="colon">:</span></dt>
<dd class="field-odd"><p>The password to use when authenticating with the Traffic Vault database.</p>
</dd>
<dt class="field-even">port<span class="colon">:</span></dt>
<dd class="field-even"><p>The port number on which the Traffic Vault Database is listening for incoming connections (NOTE: the PostgreSQL default is 5432).</p>
</dd>
<dt class="field-odd">ssl<span class="colon">:</span></dt>
<dd class="field-odd"><p>A boolean that sets whether or not the Traffic Vault Database encrypts its connections with SSL.</p>
</dd>
<dt class="field-even">user<span class="colon">:</span></dt>
<dd class="field-even"><p>The name of the user as whom to connect to the database.</p>
</dd>
</dl>
</section>
</section>
</section>
<section id="riak-deprecated">
<span id="traffic-vault-riak-backend"></span><h2>Riak (deprecated)<a class="headerlink" href="#riak-deprecated" title="Permalink to this heading"></a></h2>
<div class="deprecated">
<p><span class="versionmodified deprecated">Deprecated since version ATCv6: </span>The Riak Traffic Vault backend is deprecated and support may be removed in a future release. It is highly recommended to use the PostgreSQL Traffic Vault backend instead.</p>
</div>
<p>In order to use the Riak backend for Traffic Vault, you will need to set the <code class="docutils literal notranslate"><span class="pre">traffic_vault_backend</span></code> option to <code class="docutils literal notranslate"><span class="pre">&quot;riak&quot;</span></code> and include the necessary configuration in the <code class="docutils literal notranslate"><span class="pre">traffic_vault_config</span></code> section in <code class="file docutils literal notranslate"><span class="pre">cdn.conf</span></code>. The <code class="docutils literal notranslate"><span class="pre">traffic_vault_config</span></code> options for the Riak backend are as follows:</p>
<dl class="field-list simple">
<dt class="field-odd">password<span class="colon">:</span></dt>
<dd class="field-odd"><p>The password to use when authenticating with Riak</p>
</dd>
<dt class="field-even">user<span class="colon">:</span></dt>
<dd class="field-even"><p>The username to use when authenticating with Riak</p>
</dd>
<dt class="field-odd">port<span class="colon">:</span></dt>
<dd class="field-odd"><p>The Riak protobuf port to connect to. Default: 8087</p>
</dd>
<dt class="field-even">tlsConfig<span class="colon">:</span></dt>
<dd class="field-even"><p>Optional. Certain TLS options from <a class="reference external" href="https://golang.org/pkg/crypto/tls/#Config">the tls.Config struct options</a> may be included here, such as <code class="docutils literal notranslate"><span class="pre">insecureSkipVerify:</span> <span class="pre">true</span></code> to disable certificate validation in order to use self-signed certificates for test/development purposes.</p>
</dd>
<dt class="field-odd">MaxTLSVersion<span class="colon">:</span></dt>
<dd class="field-odd"><p>Optional. This is the highest TLS version that Traffic Ops is allowed to use to connect to Traffic Vault. Valid values are “1.0”, “1.1”, “1.2”, and “1.3”. The default is “1.1”.</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Enabling TLS 1.1 in Riak itself is required for Traffic Ops to communicate with Riak. See <a class="reference internal" href="#tv-admin-enable-tlsv1-1"><span class="std std-ref">Enabling TLS 1.1</span></a> for details.</p>
</div>
<section id="id1">
<h3>Example cdn.conf snippet:<a class="headerlink" href="#id1" title="Permalink to this heading"></a></h3>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;traffic_ops_golang&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;traffic_vault_backend&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;riak&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;traffic_vault_config&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;user&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;riakuser&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;password&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;password&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;MaxTLSVersion&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1.1&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;port&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">8087</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="installing-the-riak-backend-for-traffic-vault">
<h3>Installing the Riak backend for Traffic Vault<a class="headerlink" href="#installing-the-riak-backend-for-traffic-vault" title="Permalink to this heading"></a></h3>
<p>In order to successfully store private keys you will need to install Riak. The latest version of Riak can be downloaded on <a class="reference external" href="https://docs.riak.com/riak/latest/downloads/">the Riak website</a>. The installation instructions for Riak can be found <a class="reference external" href="https://docs.riak.com/riak/kv/latest/setup/installing/index.html">here</a>. Based on experience, version 2.0.5 of Riak is recommended, but the latest version should suffice.</p>
</section>
<section id="configuring-riak">
<h3>Configuring Riak<a class="headerlink" href="#configuring-riak" title="Permalink to this heading"></a></h3>
<p>Follow these steps to configure Riak in a production environment.</p>
<section id="self-signed-certificate-configuration">
<h4>Self Signed Certificate configuration<a class="headerlink" href="#self-signed-certificate-configuration" title="Permalink to this heading"></a></h4>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Self-signed certificates are not recommended for production use. Intended for development or learning purposes only. Modify subject as necessary.</p>
</div>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-number">#68 </span><span class="caption-text">Self-Signed Certificate Configuration</span><a class="headerlink" href="#id3" title="Permalink to this code"></a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>~
mkdir<span class="w"> </span>certs
<span class="nb">cd</span><span class="w"> </span>certs
openssl<span class="w"> </span>genrsa<span class="w"> </span>-out<span class="w"> </span>ca-bundle.key<span class="w"> </span><span class="m">2048</span>
openssl<span class="w"> </span>req<span class="w"> </span>-new<span class="w"> </span>-key<span class="w"> </span>ca-bundle.key<span class="w"> </span>-out<span class="w"> </span>ca-bundle.csr<span class="w"> </span>-subj<span class="w"> </span><span class="s2">&quot;/C=US/ST=CO/L=DEN/O=somecompany/OU=CDN/CN=somecompany.net/emailAddress=someuser@somecompany.net&quot;</span>
openssl<span class="w"> </span>x509<span class="w"> </span>-req<span class="w"> </span>-days<span class="w"> </span><span class="m">365</span><span class="w"> </span>-in<span class="w"> </span>ca-bundle.csr<span class="w"> </span>-signkey<span class="w"> </span>ca-bundle.key<span class="w"> </span>-out<span class="w"> </span>ca-bundle.crt
openssl<span class="w"> </span>genrsa<span class="w"> </span>-out<span class="w"> </span>server.key<span class="w"> </span><span class="m">2048</span>
openssl<span class="w"> </span>req<span class="w"> </span>-new<span class="w"> </span>-key<span class="w"> </span>server.key<span class="w"> </span>-out<span class="w"> </span>server.csr<span class="w"> </span>-subj<span class="w"> </span><span class="s2">&quot;/C=US/ST=CO/L=DEN/O=somecompany/OU=CDN/CN=somecompany.net/emailAddress=someuser@somecompany.net&quot;</span>
openssl<span class="w"> </span>x509<span class="w"> </span>-req<span class="w"> </span>-days<span class="w"> </span><span class="m">365</span><span class="w"> </span>-in<span class="w"> </span>server.csr<span class="w"> </span>-CA<span class="w"> </span>ca-bundle.crt<span class="w"> </span>-CAkey<span class="w"> </span>ca-bundle.key<span class="w"> </span>-CAcreateserial<span class="w"> </span>-out<span class="w"> </span>server.crt
mkdir<span class="w"> </span>/etc/riak/certs
mv<span class="w"> </span>-f<span class="w"> </span>server.crt<span class="w"> </span>/etc/riak/certs/.
mv<span class="w"> </span>-f<span class="w"> </span>server.key<span class="w"> </span>/etc/riak/certs/.
mv<span class="w"> </span>-f<span class="w"> </span>ca-bundle.crt<span class="w"> </span>/etc/pki/tls/certs/.
</pre></div>
</div>
</div>
</section>
<section id="riak-configuration-file">
<h4>Riak Configuration File<a class="headerlink" href="#riak-configuration-file" title="Permalink to this heading"></a></h4>
<p>The following steps need to be performed on each Riak server in the cluster:</p>
<ol class="arabic">
<li><p>Log into Riak server as root</p></li>
<li><p>Update the following in <code class="file docutils literal notranslate"><span class="pre">riak.conf</span></code> to reflect your IP, hostname, and CDN domains and sub-domains:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">nodename</span> <span class="pre">=</span> <span class="pre">riak&#64;a-host.sys.kabletown.net</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">listener.http.internal</span> <span class="pre">=</span> <span class="pre">a-host.sys.kabletown.net:8098</span></code> (port can be 80 - This endpoint will not work over HTTPS)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">listener.protobuf.internal</span> <span class="pre">=</span> <span class="pre">a-host.sys.kabletown.net:8087</span></code> (can be different port if you want)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">listener.https.internal</span> <span class="pre">=</span> <span class="pre">a-host.sys.kabletown.net:8088</span></code> (port can be 443)</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Update the following in <code class="file docutils literal notranslate"><span class="pre">riak.conf</span></code> file to point to your SSL certificate files</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ssl.certfile</span> <span class="pre">=</span> <span class="pre">/etc/riak/certs/server.crt</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ssl.keyfile</span> <span class="pre">=</span> <span class="pre">/etc/riak/certs/server.key</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ssl.cacertfile</span> <span class="pre">=</span> <span class="pre">/etc/pki/tls/certs/ca-bundle.crt</span></code></p></li>
</ul>
</div></blockquote>
</li>
</ol>
<section id="enabling-tls-1-1-required">
<span id="tv-admin-enable-tlsv1-1"></span><h5>Enabling TLS 1.1 (required)<a class="headerlink" href="#enabling-tls-1-1-required" title="Permalink to this heading"></a></h5>
<ol class="arabic simple">
<li><p>Add a line at the bottom of the <code class="file docutils literal notranslate"><span class="pre">riak.conf</span></code> for TLSv1.1 by setting <code class="docutils literal notranslate"><span class="pre">tls_protocols.tlsv1.1</span> <span class="pre">=</span> <span class="pre">on</span></code></p></li>
<li><p>Once the configuration file has been updated restart Riak</p></li>
<li><p>Consult the <a class="reference external" href="https://docs.riak.com/riak/kv/latest/setup/installing/verify/">Riak documentation</a> for instructions on how to verify the installed service</p></li>
</ol>
</section>
</section>
<section id="riak-admin-configuration">
<h4><code class="docutils literal notranslate"><span class="pre">riak-admin</span></code> Configuration<a class="headerlink" href="#riak-admin-configuration" title="Permalink to this heading"></a></h4>
<p><code class="docutils literal notranslate"><span class="pre">riak-admin</span></code> is a command line utility used to configure Riak that needs to be run as root on a server in the Riak cluster.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference external" href="https://docs.riak.com/riak/kv/latest/using/admin/riak-admin/">The riak-admin documentation</a></p>
</div>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-number">#69 </span><span class="caption-text">Traffic Vault Setup with <code class="docutils literal notranslate"><span class="pre">riak-admin</span></code></span><a class="headerlink" href="#id4" title="Permalink to this code"></a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1"># This script need only be run on any *one* Riak server in the cluster</span>

<span class="c1"># Enable security and secure access groups</span>
riak-admin<span class="w"> </span>security<span class="w"> </span><span class="nb">enable</span>
riak-admin<span class="w"> </span>security<span class="w"> </span>add-group<span class="w"> </span>admins
riak-admin<span class="w"> </span>security<span class="w"> </span>add-group<span class="w"> </span>keysusers

<span class="c1"># User name and password should be stored in the traffic_vault_config section in</span>
<span class="c1"># /opt/traffic_ops/app/conf/cdn.conf on the Traffic Ops server (with traffic_vault_backend = riak)</span>
<span class="c1"># In this example, we assume the usernames &#39;admin&#39; and &#39;riakuser&#39; with</span>
<span class="c1"># respective passwords stored in the ADMIN_PASSWORD and RIAK_USER_PASSWORD</span>
<span class="c1"># environment variables</span>
riak-admin<span class="w"> </span>security<span class="w"> </span>add-user<span class="w"> </span>admin<span class="w"> </span><span class="nv">password</span><span class="o">=</span><span class="nv">$ADMIN_PASSWORD</span><span class="w"> </span><span class="nv">groups</span><span class="o">=</span>admins
riak-admin<span class="w"> </span>security<span class="w"> </span>add-user<span class="w"> </span>riakuser<span class="w"> </span><span class="nv">password</span><span class="o">=</span><span class="nv">$RIAK_USER_PASSWORD</span><span class="w"> </span><span class="nv">groups</span><span class="o">=</span>keysusers
riak-admin<span class="w"> </span>security<span class="w"> </span>add-source<span class="w"> </span>riakuser<span class="w"> </span><span class="m">0</span>.0.0.0/0<span class="w"> </span>password
riak-admin<span class="w"> </span>security<span class="w"> </span>add-source<span class="w"> </span>admin<span class="w"> </span><span class="m">0</span>.0.0.0/0<span class="w"> </span>password

<span class="c1"># Grant privileges to the admins group for everything</span>
riak-admin<span class="w"> </span>security<span class="w"> </span>grant<span class="w"> </span>riak_kv.list_buckets,riak_kv.list_keys,riak_kv.get,riak_kv.put,riak_kv.delete<span class="w"> </span>on<span class="w"> </span>any<span class="w"> </span>to<span class="w"> </span>admins

<span class="c1"># Grant privileges to keysusers group for SSL, DNSSEC, and url_sig_keys buckets only</span>
riak-admin<span class="w"> </span>security<span class="w"> </span>grant<span class="w"> </span>riak_kv.get,riak_kv.put,riak_kv.delete<span class="w"> </span>on<span class="w"> </span>default<span class="w"> </span>ssl<span class="w"> </span>to<span class="w"> </span>keysusers
riak-admin<span class="w"> </span>security<span class="w"> </span>grant<span class="w"> </span>riak_kv.get,riak_kv.put,riak_kv.delete<span class="w"> </span>on<span class="w"> </span>default<span class="w"> </span>dnssec<span class="w"> </span>to<span class="w"> </span>keysusers
riak-admin<span class="w"> </span>security<span class="w"> </span>grant<span class="w"> </span>riak_kv.get,riak_kv.put,riak_kv.delete<span class="w"> </span>on<span class="w"> </span>default<span class="w"> </span>url_sig_keys<span class="w"> </span>to<span class="w"> </span>keysusers
riak-admin<span class="w"> </span>security<span class="w"> </span>grant<span class="w"> </span>riak_kv.get,riak_kv.put,riak_kv.delete<span class="w"> </span>on<span class="w"> </span>default<span class="w"> </span>cdn_uri_sig_keys<span class="w"> </span>to<span class="w"> </span>keysusers
</pre></div>
</div>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>For more information on security in Riak, see the <a class="reference external" href="https://docs.riak.com/riak/kv/latest/using/security/index.html">Riak Security documentation</a>.</p>
</div>
</section>
<section id="traffic-ops-configuration">
<h4>Traffic Ops Configuration<a class="headerlink" href="#traffic-ops-configuration" title="Permalink to this heading"></a></h4>
<p>Before a fully set-up Riak instance may be used as the Traffic Vault backend, it must be added as a server to Traffic Ops. The easiest way to accomplish this is via Traffic Portal at <span class="menuselection">Configure ‣ Servers</span>, though <a class="reference internal" href="../api/v5/servers.html#to-api-servers"><span class="std std-ref">servers</span></a> may also be used by low-level tools and/or scripts. The Traffic Ops configuration file <code class="file docutils literal notranslate"><span class="pre">/opt/traffic_ops/app/conf/cdn.conf</span></code> must be updated to set <code class="docutils literal notranslate"><span class="pre">traffic_vault_backend</span></code> to <code class="docutils literal notranslate"><span class="pre">&quot;riak&quot;</span></code> and the <code class="docutils literal notranslate"><span class="pre">traffic_vault_config</span></code> to include the correct username and password for accessing the Riak database.</p>
</section>
</section>
<section id="configuring-riak-search">
<h3>Configuring Riak Search<a class="headerlink" href="#configuring-riak-search" title="Permalink to this heading"></a></h3>
<p>In order to more effectively support retrieval of SSL certificates by Traffic Router and <a class="reference internal" href="../glossary.html#term-ORT"><span class="xref std std-term">ORT</span></a>, the Riak backend for Traffic Vault uses <a class="reference external" href="https://docs.riak.com/riak/kv/latest/using/reference/search/">Riak search</a>. Riak Search uses <a class="reference external" href="https://lucene.apache.org/solr">Apache Solr</a> for indexing and searching of records. This section explains how to enable, configure, and validate Riak Search.</p>
<section id="riak-configuration">
<h4>Riak Configuration<a class="headerlink" href="#riak-configuration" title="Permalink to this heading"></a></h4>
<p>On each Traffic Vault server follow these steps.</p>
<ol class="arabic">
<li><p>If Java (JDKv1.8+) is not already installed on your Riak server, install Java</p>
<blockquote>
<div><div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-number">#70 </span><span class="caption-text">Check if Java is Installed, Then Install if Needed</span><a class="headerlink" href="#id5" title="Permalink to this code"></a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1"># Ensure that this outputs a Java version that is at least 1.8</span>
java<span class="w"> </span>-version

<span class="c1"># If it didn&#39;t, or produced an error because `java` doesn&#39;t exist,</span>
<span class="c1"># install the correct version</span>
<span class="c1"># (OpenJDK is used here because of its permissive license, though OracleJDK</span>
<span class="c1"># should work with some tinkering)</span>

<span class="c1"># On CentOS/RedHat/Fedora (recommended)</span>
yum<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>java-1.8.0-openjdk<span class="w"> </span>java-1.8.0-openjdk-devel

<span class="c1"># On Ubuntu/Debian/Linux Mint</span>
apt<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>openjdk-8-jdk

<span class="c1"># Arch/Manjaro</span>
pacman<span class="w"> </span>-Sy<span class="w"> </span>jdk8-openjdk
</pre></div>
</div>
</div>
</div></blockquote>
</li>
<li><p>Enable search in <code class="file docutils literal notranslate"><span class="pre">riak.conf</span></code> by changing the <code class="docutils literal notranslate"><span class="pre">search</span> <span class="pre">=</span> <span class="pre">off</span></code> setting to <code class="docutils literal notranslate"><span class="pre">search</span> <span class="pre">=</span> <span class="pre">on</span></code></p></li>
<li><p>Restart Riak to propagate configuration changes</p>
<blockquote>
<div><div class="literal-block-wrapper docutils container" id="id6">
<div class="code-block-caption"><span class="caption-number">#71 </span><span class="caption-text">Restarting Riak on <em class="manpage"><a class="manpage reference external" href="https://manpages.debian.org/systemd(1)">systemd(1)</a></em> Systems</span><a class="headerlink" href="#id6" title="Permalink to this code"></a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>systemctl<span class="w"> </span>restart<span class="w"> </span>riak
</pre></div>
</div>
</div>
</div></blockquote>
</li>
</ol>
<section id="one-time-configuration">
<h5>One-time Configuration<a class="headerlink" href="#one-time-configuration" title="Permalink to this heading"></a></h5>
<p>After Riak has been configured to use Riak Search, permissions still need need to be updated to allow users to utilize this feature. Unlike actually setting up Riak Search, the permissions step need only be done on any <em>one</em> of the Riak servers in the cluster.</p>
<ol class="arabic">
<li><p>Use <code class="docutils literal notranslate"><span class="pre">riak-admin</span></code> to grant <code class="docutils literal notranslate"><span class="pre">search.admin</span></code> permissions to the “admin” user and <code class="docutils literal notranslate"><span class="pre">search.query</span></code> permissions to <strong>both</strong> the “admin” user and the “riakuser” user. The “admin” user will also require <code class="docutils literal notranslate"><span class="pre">search.admin</span></code> permissions on the <code class="docutils literal notranslate"><span class="pre">schema</span></code> (in addition to <code class="docutils literal notranslate"><span class="pre">index</span></code>) and <code class="docutils literal notranslate"><span class="pre">riak_core.set_bucket</span></code> permissions on <code class="docutils literal notranslate"><span class="pre">any</span></code>.</p>
<blockquote>
<div><div class="literal-block-wrapper docutils container" id="id7">
<div class="code-block-caption"><span class="caption-number">#72 </span><span class="caption-text">Setting up Riak Search Permissions</span><a class="headerlink" href="#id7" title="Permalink to this code"></a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>riak-admin<span class="w"> </span>security<span class="w"> </span>grant<span class="w"> </span>search.admin<span class="w"> </span>on<span class="w"> </span>schema<span class="w"> </span>to<span class="w"> </span>admin
riak-admin<span class="w"> </span>security<span class="w"> </span>grant<span class="w"> </span>search.admin<span class="w"> </span>on<span class="w"> </span>index<span class="w"> </span>to<span class="w"> </span>admin
riak-admin<span class="w"> </span>security<span class="w"> </span>grant<span class="w"> </span>search.query<span class="w"> </span>on<span class="w"> </span>index<span class="w"> </span>to<span class="w"> </span>admin
riak-admin<span class="w"> </span>security<span class="w"> </span>grant<span class="w"> </span>search.query<span class="w"> </span>on<span class="w"> </span>index<span class="w"> </span>sslkeys<span class="w"> </span>to<span class="w"> </span>admin
riak-admin<span class="w"> </span>security<span class="w"> </span>grant<span class="w"> </span>search.query<span class="w"> </span>on<span class="w"> </span>index<span class="w"> </span>to<span class="w"> </span>riakuser
riak-admin<span class="w"> </span>security<span class="w"> </span>grant<span class="w"> </span>search.query<span class="w"> </span>on<span class="w"> </span>index<span class="w"> </span>sslkeys<span class="w"> </span>to<span class="w"> </span>riakuser
riak-admin<span class="w"> </span>security<span class="w"> </span>grant<span class="w"> </span>riak_core.set_bucket<span class="w"> </span>on<span class="w"> </span>any<span class="w"> </span>to<span class="w"> </span>admin
</pre></div>
</div>
</div>
</div></blockquote>
</li>
<li><p>Add the search schema to Riak. This schema is a simple Apache Solr configuration file which will index all records on CDN, hostname, and <a class="reference internal" href="../glossary.html#term-Delivery-Service"><span class="xref std std-term">Delivery Service</span></a>. The file can be found at <code class="file docutils literal notranslate"><span class="pre">traffic_ops/app/config/misc/riak_search/sslkeys.xml</span></code> in the Traffic Control repository.</p>
<blockquote>
<div><div class="literal-block-wrapper docutils container" id="id8">
<div class="code-block-caption"><span class="caption-number">#73 </span><span class="caption-text">Adding the GitHub-hosted Search Schema to Riak</span><a class="headerlink" href="#id8" title="Permalink to this code"></a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Obtain the configuration file - in this example by downloading it from GitHub</span>
wget<span class="w"> </span>https://raw.githubusercontent.com/apache/trafficcontrol/master/traffic_ops/app/conf/misc/riak_search/sslkeys.xml

<span class="c1"># Upload the schema to the Riak server using its API</span>
<span class="c1"># Note that the assumptions made here are that the &quot;admin&quot; user&#39;s password is &quot;pass&quot;</span>
<span class="c1"># and the server is accessible at port 8088 on the hostname &quot;trafficvault.infra.ciab.test&quot;</span>
curl<span class="w"> </span>--tlsv1.1<span class="w"> </span>--tls-max<span class="w"> </span><span class="m">1</span>.1<span class="w"> </span>-kvsX<span class="w"> </span>PUT<span class="w"> </span><span class="s2">&quot;https://admin:pass@trafficvault.infra.ciab.test:8088/search/schema/sslkeys&quot;</span><span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/xml&quot;</span><span class="w"> </span>-d<span class="w"> </span>@sslkeys.xml
</pre></div>
</div>
</div>
</div></blockquote>
</li>
<li><p>Add the search index to Riak.</p>
<blockquote>
<div><div class="literal-block-wrapper docutils container" id="id9">
<div class="code-block-caption"><span class="caption-number">#74 </span><span class="caption-text">Adding the Search Index to Riak Via its API</span><a class="headerlink" href="#id9" title="Permalink to this code"></a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Note that the assumptions made here are that the &quot;admin&quot; user&#39;s password is &quot;pass&quot;</span>
<span class="c1"># and the server is accessible at port 8088 on the hostname &quot;trafficvault.infra.ciab.test&quot;</span>
curl<span class="w"> </span>--tlsv1.1<span class="w"> </span>--tls-max<span class="w"> </span><span class="m">1</span>.1<span class="w"> </span>-kvsX<span class="w"> </span>PUT<span class="w"> </span><span class="s2">&quot;https://admin:pass@trafficvault.infra.ciab.test:8088/search/index/sslkeys&quot;</span><span class="w"> </span>-H<span class="w"> </span><span class="s1">&#39;Content-Type: application/json&#39;</span><span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39;{&quot;schema&quot;:&quot;sslkeys&quot;}&#39;</span>
</pre></div>
</div>
</div>
</div></blockquote>
</li>
<li><p>Associate the <code class="docutils literal notranslate"><span class="pre">sslkeys</span></code> index to the <code class="docutils literal notranslate"><span class="pre">ssl</span></code> bucket in Riak</p>
<blockquote>
<div><div class="literal-block-wrapper docutils container" id="id10">
<div class="code-block-caption"><span class="caption-number">#75 </span><span class="caption-text">Using the Riak API to Create an Index-to-Bucket Association for <code class="docutils literal notranslate"><span class="pre">sslkeys</span></code></span><a class="headerlink" href="#id10" title="Permalink to this code"></a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Note that the assumptions made here are that the &quot;admin&quot; user&#39;s password is &quot;pass&quot;</span>
<span class="c1"># and the server is accessible at port 8088 on the hostname &quot;trafficvault.infra.ciab.test&quot;</span>
curl<span class="w"> </span>--tlsv1.1<span class="w"> </span>--tls-max<span class="w"> </span><span class="m">1</span>.1<span class="w"> </span>-kvs<span class="w"> </span>-XPUT<span class="w"> </span><span class="s2">&quot;https://admin:pass@trafficvault.infra.ciab.test:8088/buckets/ssl/props&quot;</span><span class="w"> </span>-H<span class="s1">&#39;content-type:application/json&#39;</span><span class="w"> </span>-d<span class="s1">&#39;{&quot;props&quot;:{&quot;search_index&quot;:&quot;sslkeys&quot;}}&#39;</span>
</pre></div>
</div>
</div>
</div></blockquote>
</li>
<li><p>To validate the search is working run a query against the Riak database server, or use the Traffic Ops API endpoint: <a class="reference internal" href="../api/v5/cdns_name_name_sslkeys.html#to-api-cdns-name-name-sslkeys"><span class="std std-ref">cdns/name/{{name}}/sslkeys</span></a></p>
<blockquote>
<div><div class="literal-block-wrapper docutils container" id="id11">
<div class="code-block-caption"><span class="caption-number">#76 </span><span class="caption-text">Validate Riak Search is Working</span><a class="headerlink" href="#id11" title="Permalink to this code"></a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Note that the assumptions made here are that the &quot;admin&quot; user&#39;s password is</span>
<span class="c1"># &quot;pass&quot;, the Traffic Vault server&#39;s Riak database is accessible at port 8088 on</span>
<span class="c1"># the hostname &quot;trafficvault.infra.ciab.test&quot;, $COOKIE contains a valid</span>
<span class="c1"># Mojolicious cookie for a Traffic Ops user with proper permissions, and the</span>
<span class="c1"># Traffic Ops server is available at the hostname &quot;trafficops.infra.ciab.test&quot;</span>

<span class="c1"># Verify by querying Riak directly</span>
curl<span class="w"> </span>--tlsv1.1<span class="w"> </span>--tls-max<span class="w"> </span><span class="m">1</span>.1<span class="w"> </span>-kvs<span class="w"> </span><span class="s2">&quot;https://admin:password@trafficvault.infra.ciab.test:8088/search/query/sslkeys?wt=json&amp;q=cdn:CDN-in-a-Box&quot;</span>

<span class="c1"># Verify using the Traffic Ops API</span>
curl<span class="w"> </span>-Lvs<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Cookie: </span><span class="nv">$COOKIE</span><span class="s2">&quot;</span><span class="w"> </span>https://trafficops.infra.ciab.test/api/4.0/cdns/name/mycdn/sslkeys
</pre></div>
</div>
</div>
</div></blockquote>
</li>
</ol>
</section>
</section>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="t3c/testing.html" class="btn btn-neutral float-left" title="testing" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="quick_howto/index.html" class="btn btn-neutral float-right" title="Quick How To Guides" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2018, Apache Traffic Control.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>